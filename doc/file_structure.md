# File Structure

There are three different types of files/data that are consumed and/or produced by this frameworks.
1. configuration files
2. data files (e.g., xml markup files, images or plotted detections)
3. model files (e.g., checkpoints, log files)

The framework contains a separate directory for each type of data:
```
+Graffiti_Detection
  +models
  +config
  +data
```

## Model Directory
A *model directory* is automatically generated when a configuration file is processed for the first time (e.g., the `train_inceptionV3_detector.py` is called for the configuration file). The structure of model directories is illustrated below. Each model dir contains a copy of the model's configuration file `model_config.yaml` and the configuration pipeline file `pipeline.yaml`. This allows to reuse the same model architecture and adjust the pipeline.

Additionally, the model directory is used to store
1. model checkpoints during the training process,
2. log file (in dir `logs/`) to monitor the training progress with tensorboard, and
3. the evaluation results of the detection capabilities in the `eval.txt` file.

```
+models
  +keras_models
    +{model_dir}
      +{detection model_A}
        +logs
        -model_config.yaml
        -pipeline.yaml
        -weights_init_classification_00.hdf5
        -{weight_checkpoint_1}.hdf5
        -...
        -{history_1}.yaml
        -...
        -eval.txt
      +{detection model_B}
        +logs
        -model_config.yaml
        -pipeline.yaml
        -weights_init_classification_00.hdf5
        -{weight_checkpoint_1}.hdf5
        -...
        -{history_1}.yaml
        -...
        -eval.txt
      +{classifiction model_C}
        +{dropout_dir}
          -model_config.yaml
          -weights_init_imagenet.hdf5
          -{weight_checkpoint_1}.hdf5
          -...
```

## Config Directory
The `config` directory is intended to store a set of different configurations. A configuration describes the setup and architecture of a Keras object detector and the configuration of the training process. Further information on the file structure and variables can be found <a href='doc/configuration.md'>here</a>.

```
+config
  -default_pipeline.yaml
  -{custom_pipeline_1}.yaml
  -...
```

## Data Directory
The `data` directory is used to maintain different datasets for training processes and to output the detection results of Keras model. Further some examples of images and xml markups are located in this directory.
```
+data
  +detection_output
  +evaluation_output
  +example_data
  +exported_annotations
  +images
  +trainings
```

### Trainings
The `data/trainigs` directory is used to organize the data of for different training processes. Please see <a href='doc/preparing_inputs.md'>how to setup the data for a trainig process</a>.
```
+data
  +trainings
    +{training_label_A}
      +annotations
        +test
        +train
      +TFRecords
        -data_info.yaml
        -label_map.pbtxt
        -test_dataset.record-00000-of-?????
        -...
        -train_dataset.record-00000-of-?????
        -...
```

### Evaluation and Detection Output
The directories `data/evaluation_output` and `data/detection_output` are used to store plotted detection results that are generated by the `eval_model.py` script. The structures of these directories are as follows:
```
+data
  +evaluation_output
    +{model_name}
      +{ckpt_name}
        -detections_1.jpg
        -detections_2.jpg
        -...
```
```
+data
  +detection_output
    +{model_name}
      +{ckpt_name}
        +{test_data}_{timestamp}
          -{img_name}__detections_{n}of{N}__iou_{iou}__conf_{conf}.jpg
          -{img_name}__detections_{n}of{N}__iou_{iou}__conf_{conf}.jpg
          -...
```

### Exported Annotations
When the `--export_flag` is passed as a parameter to the <a href='utils/extractAnnotations.py'>`utils/extractAnnotations.py`</a> (please look into the file for further details about the available parameters) script, the parsed ground truth annotations are extracted to a `json` file. The files are stored in the directory `data/exported_annotations`.

```
+data
  +exported_annotations
    -{markup_root_1}.json
    -{markup_root_2}.json
    -...
```

### Images
The `data/images` directory contains some example images (e.g., for the jupyter notebooks, or used by some default pipeline configurations).

```
+data
  +detection_test
  +train_classification_dataset
  +train_detection_dataset
```

### Example Data
The `data/example_data` directory contains some example markup files.

```
+data
  +annotations_only
  +images_and_annotations
```
